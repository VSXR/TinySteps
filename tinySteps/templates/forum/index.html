{% extends 'base.html' %} {% load static %} {% load i18n %} {% block title %}{%
trans "TINY STEPS - PARENTS FORUM" %}{% endblock %} {% block main_contents %}
<main id="main-content">
  <div class="container mt-3 mt-md-5">
    <header class="forum-header mb-3 mb-md-5">
      <div class="row">
        <div class="col-12 text-center">
          <h1 class="display-5 fw-bold fs-2 fs-md-4 fs-lg-5">
            {% trans "PARENTS FORUM" %}
          </h1>
          <p class="lead fs-6 fs-md-5">
            {% trans "Connect with other parents, share your experiences, and
            ask questions about your parenting journey" %}
          </p>
        </div>
        <hr class="my-4 w-50 mx-auto" />
      </div>
    </header>

    <!-- Messages Container -->
    <div class="row mb-3 mb-md-4">
      <div class="col">
        <div
          id="messages-container"
          class="messages"
          role="alert"
          aria-live="assertive"
        >
          {% if messages %} {% for message in messages %}
          <div
            class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-dismissible fade show"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="{% trans 'Close this alert' %}"
            ></button>
          </div>
          {% endfor %} {% endif %}
        </div>
      </div>
    </div>

    <!-- Forum Actions -->
    <div class="row mb-3 mb-md-4">
      <div
        class="col-12 d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 gap-md-3"
      >
        <div class="forum-actions w-100 w-md-auto mb-2 mb-md-0">
          {% if user.is_authenticated %}
          <a
            href="{% url 'add_post' %}"
            class="btn btn-primary w-100 w-md-auto"
            aria-label="{% trans 'Create a new post' %}"
          >
            <i class="fa-solid fa-plus me-1 me-md-2" aria-hidden="true"></i> {%
            trans "New Post" %}
          </a>
          {% else %}
          <a
            href="{% url 'login' %}?next={% url 'add_post' %}"
            class="btn btn-outline-primary w-100 w-md-auto"
            aria-label="{% trans 'Login to create a post' %}"
          >
            <i
              class="fa-solid fa-sign-in-alt me-1 me-md-2"
              aria-hidden="true"
            ></i>
            <span class="d-inline">{% trans "Login to create a post" %}</span>
          </a>
          {% endif %}
        </div>

        <div class="forum-search w-100">
          <form
            class="d-flex"
            role="search"
            action="{% url 'parent_forum' %}"
            method="get"
            aria-label="{% trans 'Search forum posts' %}"
            novalidate
          >
            <div class="input-group">
              <input
                class="form-control"
                type="search"
                name="q"
                placeholder="{% trans 'Search posts' %}"
                aria-label="{% trans 'Search posts' %}"
                value="{{ query|default:'' }}"
                required
              />
              <button
                class="btn btn-primary"
                type="submit"
                aria-label="{% trans 'Submit search' %}"
              >
                <i class="fa-solid fa-search me-1" aria-hidden="true"></i>
                <span class="d-none d-md-inline">{% trans "Search" %}</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Category Filters -->
    <section aria-labelledby="forum-categories" class="mb-3 mb-md-5">
      <h2 id="forum-categories" class="h4 mb-2 mb-md-3 fs-5">
        {% trans "Filter by Topic" %}
      </h2>
      <div class="row mb-3 mb-md-4">
        <div class="col">
          <div
            class="row g-3 g-md-4 filter-categories"
            role="group"
            aria-labelledby="forum-categories"
          >
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
              <a
                href="{% url 'parent_forum' %}"
                class="btn btn-outline-primary {% if not category %}active{% endif %} w-100 py-2"
                aria-current="{% if not category %}true{% else %}false{% endif %}"
              >
                <i class="fa-solid fa-list me-1 me-md-2" aria-hidden="true"></i>
                <span class="d-none d-sm-inline">{% trans "All Posts" %}</span>
                <span class="d-inline d-sm-none">{% trans "All" %}</span>
              </a>
            </div>

            {% for cat_value, cat_name in all_categories.items %}
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
              <a
                href="{% url 'parent_forum' %}?category={{ cat_value }}"
                class="btn btn-outline-primary {% if category == cat_value %}active{% endif %} w-100 py-2"
                aria-current="{% if category == cat_value %}true{% else %}false{% endif %}"
              >
                {% if cat_value == 'feeding' %}<i
                  class="fa-solid fa-utensils me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'sleep' %}<i
                  class="fa-solid fa-moon me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'development' %}<i
                  class="fa-solid fa-chart-line me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'health' %}<i
                  class="fa-solid fa-heartbeat me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'behavior' %}<i
                  class="fa-solid fa-child me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'advice' %}<i
                  class="fa-solid fa-comments me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'travel' %}<i
                  class="fa-solid fa-plane me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'safety' %}<i
                  class="fa-solid fa-shield-alt me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'family' %}<i
                  class="fa-solid fa-users me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% elif cat_value == 'care' %}<i
                  class="fa-solid fa-baby me-1 me-md-2"
                  aria-hidden="true"
                ></i>
                {% else %}<i
                  class="fa-solid fa-tag me-1 me-md-2"
                  aria-hidden="true"
                ></i
                >{% endif %} {{ cat_name }}
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <!-- Forum Posts -->
    <section aria-labelledby="posts-heading" class="mb-4 mb-md-5">
      <h2 id="posts-heading" class="h3 mb-3 mb-md-4 fs-4">
        {% trans "Recent Discussions" %}
      </h2>
      <div class="row">
        <div class="col">
          <div id="forum-posts-container">
            {% if posts %}
            <div
              class="list-group posts"
              aria-label="{% trans 'Forum posts' %}"
            >
              {% for post in posts %}
              <article
                class="list-group-item list-group-item-action post p-3 p-md-4 mb-4 border-start border-primary border-4 shadow-sm"
                aria-labelledby="post-title-{{ post.id }}"
              >
                <!-- Post metadata header -->
                <div
                  class="d-flex flex-column flex-sm-row w-100 justify-content-between align-items-start align-items-sm-center mb-2 mb-md-3"
                >
                  <h3
                    id="post-title-{{ post.id }}"
                    class="h5 h4-md mb-2 text-break"
                  >
                    <a
                      href="{% url 'view_post' post.id %}"
                      class="post-title stretched-link text-decoration-none"
                    >
                      {{ post.title }}
                    </a>
                  </h3>
                  <div class="ms-0 ms-sm-3 mb-2 mb-sm-0 flex-shrink-0">
                    <span class="badge bg-light text-dark">
                      <i
                        class="fa-regular fa-calendar me-1"
                        aria-hidden="true"
                      ></i>
                      <time datetime="{{ post.created_at|date:'Y-m-d' }}"
                        >{{ post.created_at|date:"d M Y" }}</time
                      >
                    </span>
                  </div>
                </div>

                <!-- Post preview content -->
                <div class="post-preview mb-2 mb-md-3">
                  <p class="text-muted small">
                    {{ post.desc|truncatechars:150 }}
                  </p>
                </div>

                <!-- Post footer with metadata -->
                <div class="post-meta mb-2 mb-md-0">
                  <div class="post-stats d-flex align-items-center mb-2">
                    <span
                      class="me-3"
                      aria-label="{% blocktrans with count=post.comments.count %}{{ count }} comments{% endblocktrans %}"
                    >
                      <i
                        class="fa-solid fa-comments me-1"
                        aria-hidden="true"
                      ></i>
                      <span>{{ post.comments.count }}</span>
                    </span>
                    <span
                      aria-label="{% blocktrans with count=post.likes.count|default:'0' %}{{ count }} likes{% endblocktrans %}"
                    >
                      <i class="fa-solid fa-heart me-1" aria-hidden="true"></i>
                      <span>{{ post.likes.count|default:"0" }}</span>
                    </span>
                  </div>
                  <div class="d-flex align-items-center mb-2">
                    <img
                      src="{% if post.author.profile.avatar %}{{ post.author.profile.avatar.url }}{% else %}{% static 'res/img/others/default_avatar.jpg' %}{% endif %}"
                      alt=""
                      class="rounded-circle me-2"
                      width="24"
                      height="24"
                    />
                    <small class="text-muted">
                      {% blocktrans with username=post.author.username %}Posted
                      by <span class="fw-bold">{{ username }}</span>{%
                      endblocktrans %}
                    </small>
                  </div>
                  <div
                    class="post-categories"
                    aria-label="{% trans 'Post categories' %}"
                  >
                    {% if post.category %}
                    <a
                      href="{% url 'parent_forum' %}?category={{ post.category }}"
                      class="badge bg-primary text-decoration-none"
                    >
                      #{{ post.get_category_display }}
                    </a>
                    {% endif %} {% for tag in post.tags.all %}
                    <span class="badge bg-secondary me-1">{{ tag.name }}</span>
                    {% endfor %}
                  </div>
                </div>
              </article>
              {% endfor %}
            </div>

            <!-- Pagination with responsive classes -->
            <nav
              aria-label="{% trans 'Forum post pagination' %}"
              class="my-3 my-md-5"
            >
              <ul class="pagination justify-content-center">
                {% if posts.has_previous %}
                <li class="page-item">
                  <a
                    class="page-link"
                    href="?page=1"
                    aria-label="{% trans 'First page' %}"
                  >
                    <span aria-hidden="true">&laquo;</span>
                    <span class="d-none d-md-inline">{% trans "First" %}</span>
                  </a>
                </li>
                <li class="page-item">
                  <a
                    class="page-link"
                    href="?page={{ posts.previous_page_number }}"
                    aria-label="{% trans 'Previous page' %}"
                  >
                    <i class="fa-solid fa-chevron-left" aria-hidden="true"></i>
                    <span class="d-none d-md-inline"
                      >{% trans "Previous" %}</span
                    >
                  </a>
                </li>
                {% endif %}

                <li class="page-item active" aria-current="page">
                  <span class="page-link">
                    {% blocktrans with current=posts.number
                    total=posts.paginator.num_pages %}Page {{ current }} of {{
                    total }}{% endblocktrans %}
                  </span>
                </li>

                {% if posts.has_next %}
                <li class="page-item">
                  <a
                    class="page-link"
                    href="?page={{ posts.next_page_number }}"
                    aria-label="{% trans 'Next page' %}"
                  >
                    <span class="d-none d-md-inline">{% trans "Next" %}</span>
                    <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
                  </a>
                </li>
                <li class="page-item">
                  <a
                    class="page-link"
                    href="?page={{ posts.paginator.num_pages }}"
                    aria-label="{% trans 'Last page' %}"
                  >
                    <span class="d-none d-md-inline">{% trans "Last" %}</span>
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
                {% endif %}
              </ul>
            </nav>
            {% else %}
            <div class="alert alert-info" role="alert">
              <i class="fa-solid fa-info-circle me-2" aria-hidden="true"></i>
              {% trans "No posts have been created yet. Be the first to start a
              discussion!" %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <!-- Forum Community Guidelines -->
    <section aria-labelledby="guidelines-heading" class="mb-4 mb-md-5">
      <div class="card shadow-sm">
        <div class="card-header bg-light text-center">
          <h2 id="guidelines-heading" class="h4 mb-0 fs-5 fs-md-4">
            <i class="fa-solid fa-info-circle me-2" aria-hidden="true"></i>
            {% trans "Community Guidelines" %}
          </h2>
        </div>
        <div class="card-body p-3 p-md-4">
          <div class="row justify-content-center">
            <div class="col-12 col-md-10 mb-3">
              <h3
                class="h5 mb-3 fs-6 fs-md-5 text-center"
                id="how-to-participate"
              >
                {% trans "How to Participate" %}
              </h3>
              <div
                class="guidelines-list small"
                aria-labelledby="how-to-participate"
              >
                <p class="mb-1 text-center">
                  <i
                    class="fa-solid fa-check text-primary me-2"
                    aria-hidden="true"
                  ></i
                  >{% trans "Be respectful and supportive of other parents" %}
                </p>
                <p class="mb-1 text-center">
                  <i
                    class="fa-solid fa-check text-primary me-2"
                    aria-hidden="true"
                  ></i
                  >{% trans "Share your experiences and what worked for you" %}
                </p>
                <p class="mb-1 text-center">
                  <i
                    class="fa-solid fa-check text-primary me-2"
                    aria-hidden="true"
                  ></i
                  >{% trans "Use appropriate tags when creating posts" %}
                </p>
                <p class="mb-0 text-center">
                  <i
                    class="fa-solid fa-check text-primary me-2"
                    aria-hidden="true"
                  ></i
                  >{% trans "Keep medical advice discussions general" %}
                </p>
              </div>
            </div>
            <div class="col-12 col-md-10 mt-3">
              <h3
                class="h5 mb-2 fs-6 fs-md-5 text-center"
                id="remember-section"
              >
                {% trans "Remember" %}
              </h3>
              <div class="small text-center" aria-labelledby="remember-section">
                <p class="mb-0">
                  <i
                    class="fa-solid fa-exclamation-circle text-warning me-2"
                    aria-hidden="true"
                  ></i>
                  {% trans "This forum is designed for parent-to-parent support.
                  For medical concerns, always consult with a healthcare
                  professional." %}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>
{% endblock main_contents %} {% block extra_js %} {{ block.super }}
<script src="{% static 'res/javascript/parent_forum.js' %}"></script>
{% endblock extra_js %}
